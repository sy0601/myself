function Bullet(t){this.x=0,this.y=0,this.type=t,this.rotate=0,this.speed=2*this.type,this.move()}var BULLET_SIZE=[null,{x:86,y:0,w:24,h:26},{x:62,y:0,w:25,h:29},{x:30,y:0,w:31,h:35},{x:32,y:35,w:27,h:31},{x:30,y:82,w:29,h:33},{x:0,y:82,w:30,h:34},{x:0,y:0,w:30,h:44}];Bullet.prototype.draw=function(t){var e=BULLET_SIZE[this.type].w,h=BULLET_SIZE[this.type].h,s=BULLET_SIZE[this.type].x,a=BULLET_SIZE[this.type].y;t.save(),t.beginPath(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),t.drawImage(json.bullet,s,a,e,h,-e/2,-h/2,e,h),t.restore()},Bullet.prototype.move=function(){var t=this;setInterval(function(){t.x+=t.speed*Math.sin(d2a(t.rotate)),t.y-=t.speed*Math.cos(d2a(t.rotate))},30)};
function Cannon(t){this.x=431,this.y=570,this.type=t,this.rotate=0,this.cur=0,this.timer=null}var CANNON_SIZE=[null,{w:74,h:74},{w:74,h:76},{w:74,h:76},{w:74,h:83},{w:74,h:85},{w:74,h:90},{w:74,h:94}];Cannon.prototype.draw=function(t){var n=CANNON_SIZE[this.type].w,e=CANNON_SIZE[this.type].h;t.save(),t.beginPath(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),t.drawImage(json["cannon"+this.type],0,this.cur*e,n,e,-n/2,-e/2,n,e),t.restore()},Cannon.prototype.emitChange=function(){var t=this;clearInterval(this.timer),this.timer=setInterval(function(){t.cur+=1,5==t.cur&&(clearInterval(t.timer),t.cur=0)},30)};
function Coin(t){this.x=0,this.y=0,this.type=t,this.cur=0,this.speed=10,this.move()}Coin.prototype.draw=function(t){switch(this.type){case 1:case 2:case 3:t.save(),t.beginPath(),t.translate(this.x,this.y),t.drawImage(json.coinAni1,0,60*this.cur,60,60,-30,-30,60,60),t.restore();break;case 4:case 5:t.save(),t.beginPath(),t.translate(this.x,this.y),t.drawImage(json.coinAni2,0,60*this.cur,60,60,-30,-30,60,60),t.restore()}},Coin.prototype.move=function(){var t=this;setInterval(function(){t.cur+=1,10==t.cur&&(t.cur=0)},30),setInterval(function(){t.x+=(0-t.x)/t.speed,t.y+=(660-t.y)/t.speed},30)},Coin.prototype.playSong=function(){var t=new Audio;t.src="mp3/coin.wav",t.play()};
function loadImage(n,t){for(var a=0,r=0;r<n.length;r++){var o=new Image;o.src="img/"+n[r]+".png",function(r){o.onload=function(){json[n[r]]=this,a++,a==n.length&&t&&t()}}(r)}}function d2a(n){return n*Math.PI/180}function a2d(n){return 180*n/Math.PI}function ran(n,t){return parseInt(Math.random()*(t-n)+n)}var json={};
function DieFish(t){this.x=0,this.y=0,this.type=t,this.cur=0,this.rotate=0,this.move()}var FISH_SIZE=[null,{w:55,h:37,collR:17},{w:78,h:64,collR:24},{w:72,h:56,collR:20},{w:77,h:59,collR:22},{w:107,h:122,collR:29}];DieFish.prototype.draw=function(t){var i=FISH_SIZE[this.type].w,h=FISH_SIZE[this.type].h;t.save(),t.beginPath(),t.translate(this.x,this.y),t.drawImage(json["fish"+this.type],0,(this.cur+4)*h,i,h,-i/2,-h/2,i,h),t.restore()},DieFish.prototype.move=function(){var t=this;setInterval(function(){t.cur+=1,4==t.cur&&(t.cur=0)},220)};
function Fish(t){this.x=0,this.y=0,this.type=t,this.cur=0,this.speed=1,this.rotate=0,this.collR=FISH_SIZE[this.type].collR,this.move()}var FISH_SIZE=[null,{w:55,h:37,collR:17},{w:78,h:64,collR:24},{w:72,h:56,collR:20},{w:77,h:59,collR:22},{w:107,h:122,collR:29}];Fish.prototype.draw=function(t){var s=FISH_SIZE[this.type].w,h=FISH_SIZE[this.type].h;t.save(),t.beginPath(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),t.drawImage(json["fish"+this.type],0,this.cur*h,s,h,-s/2,-h/2,s,h),t.restore()},Fish.prototype.move=function(){var t=this;setInterval(function(){t.x+=t.speed*Math.cos(d2a(t.rotate)),t.y+=t.speed*Math.sin(d2a(t.rotate))},30),setInterval(function(){t.cur+=1,4==t.cur&&(t.cur=0)},220)},Fish.prototype.isIn=function(t,s){var h=this.x-t,i=this.y-s,e=Math.sqrt(h*h+i*i);return this.collR>e};
document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector("#c1"),e=t.getContext("2d"),r=50,a=.05,n=[-r,r];loadImage(resource,function(){var o=new Cannon(7),h=[],i=[],f=[],s=[],l=[];setInterval(function(){e.clearRect(0,0,t.width,t.height),e.drawImage(json.bottom,0,0,765,70,0,532,765,70);for(var c=0;c<h.length;c++)h[c].draw(e);for(var c=0;c<h.length;c++)(h[c].x<-r||h[c].x>t.width+r||h[c].y<-r||h[c].y>t.height+r)&&h.splice(c,1);if(Math.random()<a)if(n.sort(function(){return Math.random()-.5}),n[0]<0){var d=new Fish(ran(1,6));d.x=-r,d.y=ran(r,t.height-r),d.rotate=ran(-45,45),i.push(d)}else{var d=new Fish(ran(1,6));d.x=t.width+r,d.y=ran(r,t.height-r),d.rotate=ran(135,225),i.push(d)}for(var c=0;c<i.length;c++)i[c].draw(e);for(var c=0;c<i.length;c++)(i[c].x<-r||i[c].x>t.width+r||i[c].y<-r||i[c].y>t.height+r)&&i.splice(c,1);for(var c=0;c<f.length;c++)f[c].draw(e);for(var c=0;c<s.length;c++)s[c].draw(e);for(var c=0;c<l.length;c++)l[c].draw(e),l[c].scale>1.2&&l.shift();for(var c=0;c<i.length;c++)for(var v=0;v<h.length;v++)if(i[c].isIn(h[v].x,h[v].y)){var u=i[c].type,g=i[c].x,w=i[c].y,y=i[c].rotate;i.splice(c,1),c--,h.splice(v,1),v--;var p=new Coin(u);p.x=g,p.y=w,f.push(p);var x=new DieFish(u);x.x=g,x.y=w,x.rotate=y,s.push(x),setTimeout(function(){s.shift()},400);var m=new Web(u);m.x=g,m.y=w,l.push(m)}o.draw(e)},16),t.onclick=function(e){var r=e.clientX-t.offsetLeft-t.offsetWidth/2,a=t.offsetHeight-(e.clientY-t.offsetTop),n=a2d(Math.atan2(r,a));o.rotate=n,o.emitChange();var i=new Audio;i.src="mp3/cannon.mp3",i.play();var f=new Bullet(o.type);f.x=o.x,f.y=o.y,f.rotate=o.rotate,h.push(f)}})},!1);
var resource=["fish1","fish2","fish3","fish4","fish5","bottom","cannon1","cannon2","cannon3","cannon4","cannon5","cannon6","cannon7","bullet","coinAni1","coinAni2","web"];
function Web(t){this.x=0,this.y=0,this.scale=1,this.move()}Web.prototype.draw=function(t){t.save(),t.beginPath(),t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.drawImage(json.web,0,0,220,220,-110,-110,220,220),t.restore()},Web.prototype.move=function(){var t=this;setInterval(function(){t.scale+=.01},30)};